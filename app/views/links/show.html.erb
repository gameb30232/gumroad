<% content_for :meta do %>
  <link href="<%= @product.long_url %>" rel="canonical">

  <% if @product.native_type == Link::NATIVE_TYPE_EBOOK %>
    <%
      work_examples = []

      book_files = @product.alive_product_files.select(&:supports_isbn?)

      book_files.each do |file|
        work_example = {
          "@type" => "Book",
          "bookFormat" => "EBook",
          "name" => "#{@product.name} (#{file.filetype.upcase})"
        }

        work_example["isbn"] = file.isbn if file.isbn.present?

        work_examples << work_example
      end

      structured_data = {
        "@context" => "https://schema.org",
        "@type" => "Book",
        "name" => @product.name,
        "author" => {
          "@type" => "Person",
          "name" => @product.user.name
        },
        "description" => @product.custom_summary.presence || strip_tags(@product.html_safe_description).truncate(160),
        "url" => @product.long_url
      }

      structured_data["workExample"] = work_examples if work_examples.any?
    %>
    <script type="application/ld+json">
      <%= structured_data.to_json.html_safe %>
    </script>
  <% end %>
<% end %>

<%= render("layouts/custom_styles/style") %>

<%= render("shared/js_needed_notice") %>

<%= load_pack("product") %>
<% if params[:layout] == "profile" %>
  <%= react_component "ProfileProductPage", props: @product_props.merge({ creator_profile: ProfilePresenter.new(pundit_user:, seller: @product.user).creator_profile }), prerender: true %>
<% elsif params[:layout] == "discover" %>
  <%= react_component "DiscoverProductPage", props: @product_props.merge(@discover_props), prerender: true %>
<% elsif params[:embed] || params[:overlay] %>
  <%= react_component "ProductIframePage", props: @product_props, prerender: true %>
<% else %>
  <%= react_component "ProductPage", props: @product_props, prerender: true %>
<% end %>
